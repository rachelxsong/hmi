---
title: "HMI Follow-Up Full Report"
author: "Stanford SPARQ"
date: "June 2020"
output:
  html_document:
    code_folding: hide
    self_contained: yes
    toc: yes
    toc_depth: 4
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(psych)
library(tidyverse)
library(tidyr)
library(reshape2)
library(readxl)
library(stats)
library(expss)
library(lme4)
library(lmerTest)
library(knitr)
library(emmeans)
```

```{r import, include=FALSE}
dFull <- read.csv("HMI_PrePost_Long.csv")

#collapse Nonfocal and Focal into one Trip group
df = dFull
df$Cohort <- dplyr::recode(df$Cohort, 'Nonfocal'='Trip', 'Focal'='Trip')
df$Cohort <- factor(df$Cohort)
df$Time <- factor(df$Time, levels=c("Pre", "Post"))

#subset Trip only
dTrip = subset(df, Cohort == "Trip")

#subset Jewish parents only
dJParents = subset(df, ParentReligion3 != "Not Jewish")
dJParents$ParentReligion3 <- factor(dJParents$ParentReligion3) #Remove Not Jewish factor level

#subset Gender = Male or Female only
dGenderD = subset(df, Gender == "Male" | Gender == "Female")

```

```{r chart template, include=FALSE}
# HMI hexcodes: #5E366E #ED8B00
# 95% and APA style
limits = aes(ymax = mean + (1.96*se), ymin=mean - (1.96*se))
dodge = position_dodge(width=0.9)
hmitheme=theme_bw()+
  theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        panel.border=element_blank(),
        axis.line=element_line(),
        axis.title.y = element_text(margin = margin(t=0, r=10, b=0, l=0), size=14),
        axis.title.x = element_text(margin = margin(t=10, r=0, b=0, l=0)),
        text=element_text(size=12))
```

# Connection to Jewish Life {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
jewishlife <- describeBy(df$JewishLife, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         Cohort = group2)
rownames(jewishlife) <- c()

kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishLife,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Region
```{r, echo=FALSE}
jewishlife <- describeBy(df$JewishLife, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(jewishlife) <- c()

kable(jewishlife)
```

## By Hub
```{r, echo=FALSE}
jewishlife <- describeBy(df$JewishLife, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(jewishlife) <- c()

kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishLife,list(df$Hub,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Hub'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
jewishlife <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(JewishLife, na.rm=T),
              sd = sd(JewishLife, na.rm=T),
              min = min(JewishLife, na.rm=T),
              max = max(JewishLife, na.rm=T),
              se = sd(JewishLife, na.rm=T)/sqrt(n()))

kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(jewishlife, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
jewishlife <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(JewishLife, na.rm=T),
              sd = sd(JewishLife, na.rm=T),
              min = min(JewishLife, na.rm=T),
              max = max(JewishLife, na.rm=T),
              se = sd(JewishLife, na.rm=T)/sqrt(n()))

kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(jewishlife, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$JewishLife, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="Connection to Jewish Life")
```

## By Rabbi Experience
```{r, echo=FALSE}
jewishlife <- describeBy(dTrip$JewishLife, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(jewishlife) <- c()

kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dTrip$Time=factor(dTrip$Time,labels=c("Pre","Post"))
dat=describeBy(dTrip$JewishLife,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
jewishlife <- describeBy(df$JewishLife, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(jewishlife) <- c()

kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishLife,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip

## By Birthright
```{r, echo=FALSE}
jewishlife <- describeBy(df$JewishLife, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(jewishlife) <- c()

kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishLife,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
jewishlife <- describeBy(df$JewishLife, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(jewishlife) <- c()
kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishLife,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(JewishLife ~ Time*Cohort*ReligionPersonalImportancef+ (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Connection to Jewish Life", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(JewishLife ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Connection to Jewish Life", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
jewishlife <- describeBy(dJParents$JewishLife, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

jewishlife = subset(jewishlife, select=-c(item, vars))
jewishlife = jewishlife %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(jewishlife) <- c()
kable(jewishlife)

#analyses
r1 = lmer(JewishLife ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$JewishLife,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Jewish Life \n (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```
*Excluded Ps whose parents were both not Jewish.


# Identification as Jewish Family {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
jewishfam <- describeBy(df$JewishFam, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         Cohort = group2)
rownames(jewishfam) <- c()

kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishFam,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family \n (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
jewishfam <- describeBy(df$JewishFam, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(jewishfam) <- c()

kable(jewishfam)
```

## By Hub
```{r, echo=FALSE}
jewishfam <- describeBy(df$JewishFam, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(jewishfam) <- c()

kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
jewishfam$Time <- factor(jewishfam$Time, levels=c("Pre", "Post"))
dat <- jewishfam

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family \n (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
jewishfam <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(JewishFam, na.rm=T),
              sd = sd(JewishFam, na.rm=T),
              min = min(JewishFam, na.rm=T),
              max = max(JewishFam, na.rm=T),
              se = sd(JewishFam, na.rm=T)/sqrt(n()))

kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(jewishfam, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
jewishfam <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(JewishFam, na.rm=T),
              sd = sd(JewishFam, na.rm=T),
              min = min(JewishFam, na.rm=T),
              max = max(JewishFam, na.rm=T),
              se = sd(JewishFam, na.rm=T)/sqrt(n()))

kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(jewishfam, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$JewishFam, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="Identification as Jewish Family")
```

## By Rabbi Experience
```{r, echo=FALSE}
jewishfam <- describeBy(dTrip$JewishFam, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(jewishfam) <- c()

kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$JewishFam,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family \n (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
jewishfam <- describeBy(df$JewishFam, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(jewishfam) <- c()

kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$JewishFam,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family \n (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
jewishfam <- describeBy(df$JewishFam, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(jewishfam) <- c()

kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishFam,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family \n (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
jewishfam <- describeBy(df$JewishFam, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(jewishfam) <- c()
kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$JewishFam,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family \n (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(JewishFam ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Identification as Jewish Family", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(JewishFam ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Identification as Jewish Family", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
jewishfam <- describeBy(dJParents$JewishFam, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

jewishfam = subset(jewishfam, select=-c(item, vars))
jewishfam = jewishfam %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(jewishfam) <- c()
kable(jewishfam)

#analyses
r1 = lmer(JewishFam ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$JewishFam,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family \n (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.


# Importance of Jewish Home Life {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
homelife <- describeBy(df$HomeLife, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         Cohort = group2)
rownames(homelife) <- c()

kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$HomeLife,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Not at all - Extremely)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
homelife <- describeBy(df$HomeLife, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(homelife) <- c()

kable(homelife)
```

## By Hub
```{r, echo=FALSE}
homelife <- describeBy(df$HomeLife, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(homelife) <- c()

kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
homelife$Time <- factor(homelife$Time, levels=c("Pre", "Post"))
dat <- homelife

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Not at all - Extremely)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
homelife <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(HomeLife, na.rm=T),
              sd = sd(HomeLife, na.rm=T),
              min = min(HomeLife, na.rm=T),
              max = max(HomeLife, na.rm=T),
              se = sd(HomeLife, na.rm=T)/sqrt(n()))

kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(homelife, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Not at all - Extremely)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
homelife <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(HomeLife, na.rm=T),
              sd = sd(HomeLife, na.rm=T),
              min = min(HomeLife, na.rm=T),
              max = max(HomeLife, na.rm=T),
              se = sd(HomeLife, na.rm=T)/sqrt(n()))

kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(homelife, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Identification as Jewish Family (We are not a Jewish Family - We are a Jewish Family)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")
dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$HomeLife, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="Importance of Jewish Home Life")
```

## By Rabbi Experience
```{r, echo=FALSE}
homelife <- describeBy(dTrip$HomeLife, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(homelife) <- c()

kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$HomeLife,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Not at all - Extremely)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
homelife <- describeBy(df$HomeLife, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(homelife) <- c()

kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$HomeLife,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Not at all - Extremely)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip



## By Birthright
```{r, echo=FALSE}
homelife <- describeBy(df$HomeLife, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(homelife) <- c()

kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$HomeLife,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Not at all - Extremely)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
homelife <- describeBy(df$HomeLife, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(homelife) <- c()
kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$HomeLife,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Not at all - Extremely)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(HomeLife ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Importance of Jewish Home Life", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(HomeLife ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Importance of Jewish Home Life", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
homelife <- describeBy(dJParents$HomeLife, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

homelife = subset(homelife, select=-c(item, vars))
homelife = homelife %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(homelife) <- c()
kable(homelife)

#analyses
r1 = lmer(HomeLife ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$HomeLife,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Importance of Jewish Home Life (Strongly Disagree - Strongly Agree')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Frequency of Jewish Activities {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
activities <- describeBy(df$Acts, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         Cohort = group2)
rownames(activities) <- c()

kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$Acts,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
activities <- describeBy(df$Acts, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(activities) <- c()

kable(activities)
```

## By Hub
```{r, echo=FALSE}
activities <- describeBy(df$Acts, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(activities) <- c()

kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
activities$Time <- factor(activities$Time, levels=c("Pre", "Post"))
dat <- activities

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
activities <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(Acts, na.rm=T),
              sd = sd(Acts, na.rm=T),
              min = min(Acts, na.rm=T),
              max = max(Acts, na.rm=T),
              se = sd(Acts, na.rm=T)/sqrt(n()))

kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(activities, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
activities <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(Acts, na.rm=T),
              sd = sd(Acts, na.rm=T),
              min = min(Acts, na.rm=T),
              max = max(Acts, na.rm=T),
              se = sd(Acts, na.rm=T)/sqrt(n()))

kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(activities, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$Acts, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="Frequency of Jewish Activities")
```

## By Rabbi Experience
```{r, echo=FALSE}
activities <- describeBy(dTrip$Acts, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(activities) <- c()

kable(activities)

#analyses
r1 = lmer(Acts ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$Acts,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
activities <- describeBy(df$Acts, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(activities) <- c()

kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$Acts,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
activities <- describeBy(df$Acts, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(activities) <- c()

kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$Acts,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
activities <- describeBy(df$Acts, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(activities) <- c()
kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$Acts,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(Acts ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Frequency of Jewish Activities", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(Acts ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Frequency of Jewish Activities", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
activities <- describeBy(dJParents$Acts, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

activities = subset(activities, select=-c(item, vars))
activities = activities %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(activities) <- c()
kable(activities)

#analyses
r1 = lmer(Acts ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$Acts,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Frequency of Jewish Activities w/ Kids {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
kidsactivities <- describeBy(df$ChildActs, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         Cohort = group2)
rownames(kidsactivities) <- c()

kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$ChildActs,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
kidsactivities <- describeBy(df$ChildActs, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(kidsactivities) <- c()

kable(kidsactivities)
```

## By Hub
```{r, echo=FALSE}
kidsactivities <- describeBy(df$ChildActs, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(kidsactivities) <- c()

kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
kidsactivities$Time <- factor(kidsactivities$Time, levels=c("Pre", "Post"))
dat <- kidsactivities

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
kidsactivities <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(ChildActs, na.rm=T),
              sd = sd(ChildActs, na.rm=T),
              min = min(ChildActs, na.rm=T),
              max = max(ChildActs, na.rm=T),
              se = sd(ChildActs, na.rm=T)/sqrt(n()))

kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(kidsactivities, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
kidsactivities <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(ChildActs, na.rm=T),
              sd = sd(ChildActs, na.rm=T),
              min = min(ChildActs, na.rm=T),
              max = max(ChildActs, na.rm=T),
              se = sd(ChildActs, na.rm=T)/sqrt(n()))

kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(kidsactivities, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")
dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$ChildActs, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="Frequency of Jewish Activities w/ Kids")
```

## By Rabbi Experience
```{r, echo=FALSE}
kidsactivities <- describeBy(dTrip$ChildActs, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(kidsactivities) <- c()

kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$ChildActs,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
kidsactivities <- describeBy(df$ChildActs, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(kidsactivities) <- c()

kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$ChildActs,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```
*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
kidsactivities <- describeBy(df$ChildActs, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(kidsactivities) <- c()

kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$ChildActs,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
kidsactivities <- describeBy(df$ChildActs, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(kidsactivities) <- c()
kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$ChildActs,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(ChildActs ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Frequency of Jewish Activities w/ Kids", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(ChildActs ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Frequency of Jewish Activities w/ Kids", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
kidsactivities <- describeBy(dJParents$ChildActs, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

kidsactivities = subset(kidsactivities, select=-c(item, vars))
kidsactivities = kidsactivities %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(kidsactivities) <- c()
kable(kidsactivities)

#analyses
r1 = lmer(ChildActs ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$ChildActs,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(0, 4))+
  scale_y_continuous(breaks=c(0:4))+
  hmitheme+
  ylab('Frequency of Jewish Activities w/ Kids (Never - 5+)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Connection to Israel {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
israel <- describeBy(df$IsraelComp, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         Cohort = group2)
rownames(israel) <- c()

kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IsraelComp,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
israel <- describeBy(df$IsraelComp, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(israel) <- c()

kable(israel)
```

## By Hub
```{r, echo=FALSE}
israel <- describeBy(df$IsraelComp, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(israel) <- c()

kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
israel$Time <- factor(israel$Time, levels=c("Pre", "Post"))
dat <- israel

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
israel <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(IsraelComp, na.rm=T),
              sd = sd(IsraelComp, na.rm=T),
              min = min(IsraelComp, na.rm=T),
              max = max(IsraelComp, na.rm=T),
              se = sd(IsraelComp, na.rm=T)/sqrt(n()))

kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(israel, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
israel <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IsraelComp, na.rm=T),
              sd = sd(IsraelComp, na.rm=T),
              min = min(IsraelComp, na.rm=T),
              max = max(IsraelComp, na.rm=T),
              se = sd(IsraelComp, na.rm=T)/sqrt(n()))

kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(israel, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")
dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$IsraelComp, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="Connection to Israel")
```

## By Rabbi Experience
```{r, echo=FALSE}
israel <- describeBy(dTrip$IsraelComp, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(israel) <- c()

kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IsraelComp,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
israel <- describeBy(df$IsraelComp, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(israel) <- c()

kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$IsraelComp,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip

## By Birthright
```{r, echo=FALSE}
israel <- describeBy(df$IsraelComp, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(israel) <- c()

kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IsraelComp,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
israel <- describeBy(df$IsraelComp, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(israel) <- c()
kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IsraelComp,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IsraelComp ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Connection to Israel", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IsraelComp ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="Connection to Israel", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
israel <- describeBy(dJParents$IsraelComp, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

israel = subset(israel, select=-c(item, vars))
israel = israel %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(israel) <- c()
kable(israel)

#analyses
r1 = lmer(IsraelComp ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IsraelComp,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 5))+
  scale_y_continuous(breaks=c(1:5))+
  hmitheme+
  ylab('Connection to Israel (Strongly Disagree - Strongly Agree)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Inclusion of Self - Partner {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
ios <- describeBy(df$IOS_01, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_01,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
ios <- describeBy(df$IOS_01, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(ios) <- c()

kable(ios)
```

## By Hub
```{r, echo=FALSE}
ios <- describeBy(df$IOS_01, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
ios$Time <- factor(ios$Time, levels=c("Pre", "Post"))
dat <- ios

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(IOS_01, na.rm=T),
              sd = sd(IOS_01, na.rm=T),
              min = min(IOS_01, na.rm=T),
              max = max(IOS_01, na.rm=T),
              se = sd(IOS_01, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IOS_01, na.rm=T),
              sd = sd(IOS_01, na.rm=T),
              min = min(IOS_01, na.rm=T),
              max = max(IOS_01, na.rm=T),
              se = sd(IOS_01, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$IOS_01, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="IOS Partner")
```

## By Rabbi Experience
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_01, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_01,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
ios <- describeBy(df$IOS_01, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$IOS_01,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip

## By Birthright
```{r, echo=FALSE}
ios <- describeBy(df$IOS_01, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_01,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
ios <- describeBy(df$IOS_01, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_01,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IOS_01 ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Partner", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IOS_01 ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Partner", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
ios <- describeBy(dJParents$IOS_01, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_01 ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IOS_01,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Partner (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Inclusion of Self - HMI Cohort {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_02, group=list(dTrip$Time), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dTrip$Time=factor(dTrip$Time,labels=c("Pre","Post"))
dat=describeBy(dTrip$IOS_02,list(dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Time, y = mean))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_02, group=list(dTrip$Time, dTrip$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Region = group2)
rownames(ios) <- c()

kable(ios)
```

## By Hub
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_02, group=list(dTrip$Time, dTrip$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Hub = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*Hub + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
ios$Time <- factor(ios$Time, levels=c("Pre", "Post"))
dat <- ios

p=ggplot(dat, aes(x = Hub, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Gender) %>%
    summarise(n = n(),
              mean = mean(IOS_02, na.rm=T),
              sd = sd(IOS_02, na.rm=T),
              min = min(IOS_02, na.rm=T),
              max = max(IOS_02, na.rm=T),
              se = sd(IOS_02, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Gender, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IOS_02, na.rm=T),
              sd = sd(IOS_02, na.rm=T),
              min = min(IOS_02, na.rm=T),
              max = max(IOS_02, na.rm=T),
              se = sd(IOS_02, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Gender, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$IOS_02, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="IOS-HMI Cohort")
```

## By Rabbi Experience
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_02, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_02,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
dTrip$ChildrenPreD = factor(dTrip$ChildrenPreD, labels = c("No kids","Kids"))
ios <- describeBy(dTrip$IOS_02, group=list(dTrip$Time, dTrip$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Kids*" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_02,list(dTrip$ChildrenPreD,dTrip$Time,dTrip$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = ChildrenPreD, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  xlab('Kids prior to the trip')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip

## By Birthright
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_02, group=list(dTrip$Time, dTrip$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Birthright = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*Birthrightf + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dTrip$Time=factor(dTrip$Time,labels=c("Pre","Post"))
dat=describeBy(dTrip$IOS_02,list(dTrip$Birthrightf,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Birthrightf, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  xlab('Birthright')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_02, group=list(dTrip$Time, dTrip$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Born Jewish" = group2)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*JewishBorn + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dTrip$Time=factor(dTrip$Time,labels=c("Pre","Post"))
dat=describeBy(dTrip$IOS_02,list(dTrip$JewishBorn,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = JewishBorn, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  xlab('Born or Converted Jewish')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IOS_02 ~ Time*ReligionPersonalImportancef + (1|AccountID) + (1|ContactID), data=dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef, at=plot, CIs=TRUE) +
  labs(y="IOS - HMI Cohort", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IOS_02 ~ Time*ReligionFamilyImportancef + (1|AccountID) + (1|ContactID), data=dTrip)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef, at=plot, CIs=TRUE) +
  labs(y="IOS - HMI Cohort", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
ios <- describeBy(dJParents$IOS_02, group=list(dJParents$Time, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Parents' Religion*" = group2)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_02 ~ Time*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IOS_02,list(dJParents$ParentReligion3,dJParents$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = ParentReligion3, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Cohort (No overlap - Full overlap)')+
  xlab('Parent Religion')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Inclusion of Self - HMI as a whole {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_03, group=list(dTrip$Time), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dTrip$Time=factor(dTrip$Time,labels=c("Pre","Post"))
dat=describeBy(dTrip$IOS_03,list(dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Time, y = mean))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_03, group=list(dTrip$Time, dTrip$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Region = group2)
rownames(ios) <- c()

kable(ios)
```

## By Hub
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_03, group=list(dTrip$Time, dTrip$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Hub = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time*Hub + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
ios$Time <- factor(ios$Time, levels=c("Pre", "Post"))
dat <- ios

p=ggplot(dat, aes(x = Hub, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Gender) %>%
    summarise(n = n(),
              mean = mean(IOS_03, na.rm=T),
              sd = sd(IOS_03, na.rm=T),
              min = min(IOS_03, na.rm=T),
              max = max(IOS_03, na.rm=T),
              se = sd(IOS_03, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Gender, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IOS_03, na.rm=T),
              sd = sd(IOS_03, na.rm=T),
              min = min(IOS_03, na.rm=T),
              max = max(IOS_03, na.rm=T),
              se = sd(IOS_03, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Gender, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$IOS_03, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="IOS HMI Whole")
```

## By Rabbi Experience
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_03, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_03,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
dTrip$ChildrenPreD = factor(dTrip$ChildrenPreD, labels = c("No kids","Kids"))
ios <- describeBy(dTrip$IOS_03, group=list(dTrip$Time, dTrip$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Kids*" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_03,list(dTrip$ChildrenPreD,dTrip$Time,dTrip$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = ChildrenPreD, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  xlab('Kids prior to the trip')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_03, group=list(dTrip$Time, dTrip$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Birthright = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time*Birthrightf + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dTrip$Time=factor(dTrip$Time,labels=c("Pre","Post"))
dat=describeBy(dTrip$IOS_03,list(dTrip$Birthrightf,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Birthrightf, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  xlab('Birthright')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_03, group=list(dTrip$Time, dTrip$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Born Jewish" = group2)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_03 ~ Time*JewishBorn + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dTrip$Time=factor(dTrip$Time,labels=c("Pre","Post"))
dat=describeBy(dTrip$IOS_03,list(dTrip$JewishBorn,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = JewishBorn, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  xlab('Born or Converted Jewish')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IOS_03 ~ Time*ReligionPersonalImportancef + (1|AccountID) + (1|ContactID), data=dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef, at=plot, CIs=TRUE) +
  labs(y="IOS HMI Whole", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IOS_03 ~ Time*ReligionFamilyImportancef + (1|AccountID) + (1|ContactID), data=dTrip)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef, at=plot, CIs=TRUE) +
  labs(y="IOS HMI Whole", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
ios <- describeBy(dJParents$IOS_03, group=list(dJParents$Time, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Parents' Religion*" = group2)
rownames(ios) <- c()
kable(ios)

r1 = lmer(IOS_03 ~ Time*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IOS_03,list(dJParents$ParentReligion3,dJParents$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = ParentReligion3, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS HMI Whole (No overlap - Full overlap)')+
  xlab('Parent Religion')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```
*Excluded Ps whose parents were both not Jewish.


# Inclusion of Self - Jews in my city {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
ios <- describeBy(df$IOS_04, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_04,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
ios <- describeBy(df$IOS_04, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(ios) <- c()

kable(ios)
```

## By Hub
```{r, echo=FALSE}
ios <- describeBy(df$IOS_04, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
ios$Time <- factor(ios$Time, levels=c("Pre", "Post"))
dat <- ios

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(IOS_04, na.rm=T),
              sd = sd(IOS_04, na.rm=T),
              min = min(IOS_04, na.rm=T),
              max = max(IOS_04, na.rm=T),
              se = sd(IOS_04, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IOS_04, na.rm=T),
              sd = sd(IOS_04, na.rm=T),
              min = min(IOS_04, na.rm=T),
              max = max(IOS_04, na.rm=T),
              se = sd(IOS_04, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$IOS_04, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="IOS Jews in my city")
```

## By Rabbi Experience
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_04, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_04,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
ios <- describeBy(df$IOS_04, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$IOS_04,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
ios <- describeBy(df$IOS_04, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_04,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
ios <- describeBy(df$IOS_04, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_04,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IOS_04 ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Jews in my city", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IOS_04 ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Jews in my city", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
ios <- describeBy(dJParents$IOS_04, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_04 ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IOS_04,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jews in my city (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```
*Excluded Ps whose parents were both not Jewish.

# Inclusion of Self - American Jews {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
ios <- describeBy(df$IOS_05, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_05,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
ios <- describeBy(df$IOS_05, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(ios) <- c()

kable(ios)
```

## By Hub
```{r, echo=FALSE}
ios <- describeBy(df$IOS_05, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
ios$Time <- factor(ios$Time, levels=c("Pre", "Post"))
dat <- ios

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(IOS_05, na.rm=T),
              sd = sd(IOS_05, na.rm=T),
              min = min(IOS_05, na.rm=T),
              max = max(IOS_05, na.rm=T),
              se = sd(IOS_05, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IOS_05, na.rm=T),
              sd = sd(IOS_05, na.rm=T),
              min = min(IOS_05, na.rm=T),
              max = max(IOS_05, na.rm=T),
              se = sd(IOS_05, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$IOS_05, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="IOS American Jews")
```

## By Rabbi Experience
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_05, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_05,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
ios <- describeBy(df$IOS_05, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$IOS_05,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```
*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
ios <- describeBy(df$IOS_05, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_05,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
ios <- describeBy(df$IOS_05, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_05,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IOS_05 ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS American Jews", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IOS_05 ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS American Jews", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
ios <- describeBy(dJParents$IOS_05, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_05 ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IOS_05,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS American Jews (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Inclusion of Self - Jewish Israelis {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
ios <- describeBy(df$IOS_06, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_06,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
ios <- describeBy(df$IOS_06, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(ios) <- c()

kable(ios)
```

## By Hub
```{r, echo=FALSE}
ios <- describeBy(df$IOS_06, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
ios$Time <- factor(ios$Time, levels=c("Pre", "Post"))
dat <- ios

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(IOS_06, na.rm=T),
              sd = sd(IOS_06, na.rm=T),
              min = min(IOS_06, na.rm=T),
              max = max(IOS_06, na.rm=T),
              se = sd(IOS_06, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IOS_06, na.rm=T),
              sd = sd(IOS_06, na.rm=T),
              min = min(IOS_06, na.rm=T),
              max = max(IOS_06, na.rm=T),
              se = sd(IOS_06, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
dTrip = subset(df, Cohort == "Trip")

dTrip$RabbiRating <- as.numeric(levels(dTrip$RabbiRating))[dTrip$RabbiRating]

plot(dTrip$RabbiRating, dTrip$IOS_06, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="IOS Jewish Israelis")
```

## By Rabbi Experience
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_06, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_06,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
ios <- describeBy(df$IOS_06, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$IOS_06,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
ios <- describeBy(df$IOS_06, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_06,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
ios <- describeBy(df$IOS_06, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_06,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IOS_06 ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Jewish Israelis", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IOS_06 ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Jewish Israelis", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
ios <- describeBy(dJParents$IOS_06, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_06 ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IOS_06,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Jewish Israelis (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

*Excluded Ps whose parents were both not Jewish.

# Inclusion of Self - Global Jewish Community {.tabset .tabset-fade}
## Overall
```{r, echo=FALSE}
ios <- describeBy(df$IOS_07, group=list(df$Time, df$Cohort), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_07,list(df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Time'
names(dat)[names(dat) == 'group2'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Region
```{r, echo=FALSE}
ios <- describeBy(df$IOS_07, group=list(df$Time, df$Cohort, df$Region), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Region = group3)
rownames(ios) <- c()

kable(ios)
```

## By Hub
```{r, echo=FALSE}
ios <- describeBy(df$IOS_07, group=list(df$Time, df$Cohort, df$Hub), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Hub = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort*Hub + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
ios$Time <- factor(ios$Time, levels=c("Pre", "Post"))
dat <- ios

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Hub)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Gender
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender) %>%
    summarise(n = n(),
              mean = mean(IOS_07, na.rm=T),
              sd = sd(IOS_07, na.rm=T),
              min = min(IOS_07, na.rm=T),
              max = max(IOS_07, na.rm=T),
              se = sd(IOS_07, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort*Gender + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


Gender x Religion
```{r, echo=FALSE}
options(digits=3)
ios <- dGenderD %>% 
  group_by(Time, Cohort, Gender, JewishD) %>%
    summarise(n = n(),
              mean = mean(IOS_07, na.rm=T),
              sd = sd(IOS_07, na.rm=T),
              min = min(IOS_07, na.rm=T),
              max = max(IOS_07, na.rm=T),
              se = sd(IOS_07, na.rm=T)/sqrt(n()))

kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort*Gender*JewishD + (1|AccountID)+ (1|ContactID), data = dGenderD)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
p=ggplot(ios, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( JewishD~Gender)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Rabbi Rating
```{r, echo=FALSE}
plot(dTrip$RabbiRating, dTrip$IOS_07, sub="Not enough variance for significant correlation", xlab="Average Rabbi Rating", ylab="IOS Global Jewish community")
```

## By Rabbi Experience
```{r, echo=FALSE}
ios <- describeBy(dTrip$IOS_07, group=list(dTrip$Time, dTrip$RabbiExpd), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         "Rabbi Experience" = group2)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*RabbiExpd + (1|AccountID)+ (1|ContactID), data = dTrip)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(dTrip$IOS_07,list(dTrip$RabbiExpd,dTrip$Time),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'RabbiExpd'
names(dat)[names(dat) == 'group2'] = 'Time'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = RabbiExpd, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Rabbi Experience')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```


## By Children
```{r, echo=FALSE}
df$ChildrenPreD = factor(df$ChildrenPreD, labels = c("No kids","Kids"))
ios <- describeBy(df$IOS_07, group=list(df$Time, df$Cohort, df$ChildrenPreD), digits=3, skew=FALSE, mat=TRUE)


#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Kids*" = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort*ChildrenPreD + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dat=describeBy(df$IOS_07,list(df$ChildrenPreD,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ChildrenPreD'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ChildrenPreD)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p

```

*If they had kids or not before the trip


## By Birthright
```{r, echo=FALSE}
ios <- describeBy(df$IOS_07, group=list(df$Time, df$Cohort, df$Birthrightf), digits=3, skew=FALSE, mat=TRUE)

#cleanup table
ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         Birthright = group3)
rownames(ios) <- c()

kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort*Birthrightf + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_07,list(df$Birthrightf,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'Birthrightf'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~Birthrightf)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish-by-choice
```{r, echo=FALSE}
ios <- describeBy(df$IOS_07, group=list(df$Time, df$Cohort, df$JewishBorn), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Born Jewish" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort*JewishBorn + (1|AccountID)+ (1|ContactID), data = df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
df$Time=factor(df$Time,labels=c("Pre","Post"))
dat=describeBy(df$IOS_07,list(df$JewishBorn,df$Time,df$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'JewishBorn'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~JewishBorn)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```

## By Jewish Upbringing
```{r, echo=FALSE}
#Personal Importance
r1 = lmer(IOS_07 ~ Time*Cohort*ReligionPersonalImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionPersonalImportancef=seq(1,4,by=1))
emmip(r1, Time~ReligionPersonalImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Global Jewish community", x="Importance of religion personally growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))

#FamilyImportance
r2 = lmer(IOS_07 ~ Time*Cohort*ReligionFamilyImportancef + (1|AccountID)+ (1|ContactID), data=df)
coeffs <- coef(summary(r2))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

plot <- list(ReligionFamilyImportancef=seq(1,4,by=1))
emmip(r2, Time~ReligionFamilyImportancef | Cohort, at=plot, CIs=TRUE) +
  facet_wrap(~Cohort) +
  labs(y="IOS Global Jewish community", x="Importance of religion in their family growing up") +
  scale_color_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
```

## By Parents' Religion
```{r, echo=FALSE}
ios <- describeBy(dJParents$IOS_07, group=list(dJParents$Time, dJParents$Cohort, dJParents$ParentReligion3), digits=3, skew=FALSE, mat=TRUE)

ios = subset(ios, select=-c(item, vars))
ios = ios %>%
  rename(Time = group1,
         Cohort = group2,
         "Parents' Religion*" = group3)
rownames(ios) <- c()
kable(ios)

#analyses
r1 = lmer(IOS_07 ~ Time*Cohort*ParentReligion3 + (1|AccountID)+ (1|ContactID), data = dJParents)
coeffs <- coef(summary(r1))
p <- pnorm(abs(coeffs[, "t value"]), lower.tail=FALSE)
coeffsp <- cbind(coeffs, "p value" = round(p,3))
kable(coeffsp)

#plot
dJParents$Time=factor(dJParents$Time,labels=c("Pre","Post"))
dat=describeBy(dJParents$IOS_07,list(dJParents$ParentReligion3,dJParents$Time,dJParents$Cohort),mat=TRUE,digits=2)
names(dat)[names(dat) == 'group1'] = 'ParentReligion3'
names(dat)[names(dat) == 'group2'] = 'Time'
names(dat)[names(dat) == 'group3'] = 'Cohort'
dat$Time <- factor(dat$Time, levels=c("Pre", "Post"))

p=ggplot(dat, aes(x = Cohort, y = mean, group = Time))+
  geom_bar(stat='identity', position=dodge, aes(fill=Time))+
  facet_wrap( ~ParentReligion3)+
  geom_errorbar(limits, position=dodge, width=0.25)+
  coord_cartesian(ylim = c(1, 7))+
  scale_y_continuous(breaks=c(1:7))+
  hmitheme+
  ylab('IOS Global Jewish community (No overlap - Full overlap)')+
  xlab('Cohort')+
  scale_fill_manual(values=c("Pre" = "#5E366E", "Post" = "#ED8B00"))
p
```
*Excluded Ps whose parents were both not Jewish.
